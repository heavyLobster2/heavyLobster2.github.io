<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Random Alcohol</title>
		<script>
			document.addEventListener("DOMContentLoaded", function () {
				"use strict";
				const timeLimit = 30;
				const resetTime = 12 * 60 * 60;
				
				let alcohols = [
					{ id: "1", name: "Gin – Broker's", abv: 0.47 },
					{ id: "2", name: "Maraschino Liqueur", abv: 0.32 },
					{ id: "4", name: "St-Germain", abv: 0.20 },
					{ id: "5", name: "Green Chartreuse", abv: 0.55 },
					{ id: "6", name: "White Rum", abv: 0.40 },
					{ id: "7", name: "Dark Rum", abv: 0.40 },
					{ id: "8", name: "Blackstrap Rum", abv: 0.40 },
					{ id: "9", name: "Chambord", abv: 0.165 },
					{ id: "10", name: "Blanco Tequila", abv: 0.40 },
					{ id: "11", name: "Reposado Tequila", abv: 0.40 },
					{ id: "12", name: "Cointreau", abv: 0.40 },
					{ id: "13", name: "Vodka", abv: 0.40 },
					{ id: "14", name: "Kahlúa", abv: 0.20 },
					{ id: "15", name: "Kahlúa Chili Chocolate", abv: 0.20 },
					{ id: "16", name: "Rye Whiskey – Rittenhouse", abv: 0.50 },
					{ id: "17", name: "Rye Whiskey – Bulleit", abv: 0.45 },
					{ id: "18", name: "Bénédictine", abv: 0.40 },
					{ id: "19", name: "Sweet Vermouth", abv: 0.165 },
					{ id: "20", name: "Bourbon – Buffalo Trace", abv: 0.45 },
					{ id: "21", name: "Bourbon – Bulleit", abv: 0.45 },
					{ id: "22", name: "Cherry Liqueur", abv: 0.24 },
					{ id: "23", name: "Amaretto", abv: 0.24 },
					{ id: "24", name: "Dry Vermouth", abv: 0.175 },
					{ id: "25", name: "Campari", abv: 0.24 },
					{ id: "26", name: "Blue Curaçao", abv: 0.31 },
					{ id: "27", name: "Midori", abv: 0.20 },
					{ id: "28", name: "Scotch – Monkey Shoulder", abv: 0.43 },
					{ id: "29", name: "Scotch – Ardbeg 10", abv: 0.46 },
					{ id: "30", name: "Calvados", abv: 0.40 },
					{ id: "31", name: "Armagnac", abv: 0.40 },
					{ id: "32", name: "Fernet-Branca", abv: 0.39 },
					{ id: "33", name: "Domaine de Canton", abv: 0.28 },
					{ id: "35", name: "Frangelico", abv: 0.20 },
					{ id: "36", name: "Cynar", abv: 0.165 },
					{ id: "37", name: "Jägermeister", abv: 0.35 },
					{ id: "38", name: "Ancho Reyes", abv: 0.40 },
					{ id: "39", name: "Ancho Reyes Verde", abv: 0.40 },
					{ id: "40", name: "Mezcal", abv: 0.42 },
					{ id: "41", name: "Amaro Averna", abv: 0.29 },
					{ id: "42", name: "Tuaca", abv: 0.35 },
					{ id: "44", name: "Amaro Nonino", abv: 0.35 },
					{ id: "47", name: "Batavia Arrack", abv: 0.50 },
					{ id: "48", name: "Cocchi Americano", abv: 0.165 },
					{ id: "49", name: "Strega", abv: 0.40 },
					{ id: "50", name: "Aperol", abv: 0.11 },
					{ id: "51", name: "Punt e Mes", abv: 0.16 },
					{ id: "52", name: "Nocino", abv: 0.32 },
					{ id: "54", name: "Pama", abv: 0.17 },
					{ id: "55", name: "Crème de Mûre", abv: 0.16 },
					{ id: "56", name: "Crème de Pamplemousse", abv: 0.16 },
					{ id: "57", name: "Coconut Liqueur", abv: 0.30 },
					{ id: "58", name: "Blanc Vermouth", abv: 0.16 },
					{ id: "59", name: "Suze", abv: 0.20 },
					{ id: "60", name: "Amaro Montenegro", abv: 0.23 },
					{ id: "61", name: "Becherovka", abv: 0.38 },
					{ id: "62", name: "Licor 43", abv: 0.31 },
					{ id: "63", name: "Drambuie", abv: 0.40 },
					{ id: "64", name: "Gin – St. George Terroir", abv: 0.45 },
					{ id: "67", name: "NOLA Coffee Liqueur", abv: 0.25 },
					{ id: "68", name: "Swedish Punsch", abv: 0.26 },
					{ id: "69", name: "Praline Pecan Liqueur", abv: 0.21 },
					{ id: "70", name: "Bärenjäger", abv: 0.35 },
					{ id: "73", name: "Baileys", abv: 0.17 },
					{ id: "74", name: "Limoncello", abv: 0.30 },
					{ id: "75", name: "Liqueur de Poire", abv: 0.30 },
					{ id: "76", name: "Macadamia Liqueur", abv: 0.265 },
					{ id: "77", name: "Zirbenz", abv: 0.35 },
					{ id: "81", name: "Blueberry Liqueur", abv: 0.28 },
					{ id: "82", name: "Yellow Chartreuse", abv: 0.40 },
					{ id: "83", name: "Malört", abv: 0.35 },
					{ id: "84", name: "Goldschläger", abv: 0.435 },
					{ id: "85", name: "Bergamot Liqueur", abv: 0.20 },
					{ id: "86", name: "Chai Liqueur", abv: 0.40 },
					{ id: "87", name: "Almendra Tequila", abv: 0.18 },
					{ id: "88", name: "Passionfruit Liqueur", abv: 0.20 },
					{ id: "89", name: "Gin – Roku", abv: 0.43 }
				];
				
				document.getElementById("selectButton").addEventListener("click", function (e) {
					selectAlcohol();
					e.target.blur();
				});
				
				function selectAlcohol() {
					let timeLimitAlcohol = isWithinTimeLimit();
					if (timeLimitAlcohol) {
						displayResult(timeLimitAlcohol);
						displayTimeLimitMessage();
					}
					else {
						hideTimeLimitMessage();
						let alcohol = randomAlcohol();
						if (alcohol) {
							hideError();
							displayResult(alcohol);
							startTimeLimit(alcohol);
						}
						else {
							hideResult();
							displayError("There are no more alcohols! You have consumed all. Good job.");
							setRemainingAlcohols(null);
						}
					}
				}
				
				function displayResult(alcohol) {
					document.getElementById("resultName").textContent = alcohol.name;
					document.getElementById("resultAlcohol").textContent = Math.round(alcohol.abv * 1000) / 10 + "%";
					document.getElementById("resultWrapper").style.display = "";
				}
				
				function hideResult() {
					document.getElementById("resultWrapper").style.display = "none";
				}
				
				function displayTimeLimitMessage() {
					document.getElementById("timeLimitMessage").style.display = "";
				}
				
				function hideTimeLimitMessage() {
					document.getElementById("timeLimitMessage").style.display = "none";
				}
				
				function displayError(error) {
					let errorEl = document.getElementById("error");
					errorEl.style.display = "";
					errorEl.textContent = error;
				}
				
				function hideError() {
					document.getElementById("error").style.display = "none";
				}
				
				function startTimeLimit(alcohol) {
					if (timeLimit > 0) {
						setCookie("timeLimit", alcohol.id, timeLimit);
					}
				}
				
				function isWithinTimeLimit() {
					let timeLimitId = getCookie("timeLimit");
					if (!timeLimitId) { return null; }
					return alcohols.find(function (alcohol) {
						if (alcohol.id === timeLimitId) { return true; }
					});
				}
				
				function randomAlcohol() {
					let remaining = getRemainingAlcohols();
					if (!remaining || remaining.length === 0) {
						setRemainingAlcohols(null);  //reset
						return null;
					}
					let index = Math.floor(Math.random() * remaining.length);
					let alcohol = remaining[index];
					remaining.splice(index, 1);
					setRemainingAlcohols(remaining);
					return alcohol;
				}
				
				function getRemainingAlcohols() {
					let remaining = getCookie("remaining");
					if (remaining !== null) {
						if (remaining.length > 0) {
							return remaining.split(",").map(function (id) {
								return alcohols.find(function (alcohol) {
									if (alcohol.id === id) { return true }
									else { return false; }
								});
							});
						}
						else {
							return [];
						}
					}
					else {
						return alcohols.slice();
					}
				}
				
				function setRemainingAlcohols(remaining) {
					if (remaining) {
						setCookie("remaining", remaining.map(function (alcohol) {
							return alcohol.id;
						}).join(","), resetTime);
					}
					else {
						clearCookie("remaining");
					}
				}
				
				function setCookie(name, value, seconds) {
					let expires = "";
					if (seconds) {
						let date = new Date();
						date.setTime(date.getTime() + (seconds * 1000));
						expires = "; expires=" + date.toGMTString();
					}
					document.cookie = name + "=" + value + expires + "; path=/";
				}
				
				function getCookie(name) {
					let nameEQ = name + "=";
					let ca = document.cookie.split(";");
					for (let i = 0; i < ca.length; i++) {
						let c = ca[i];
						while (c.charAt(0) === ' ') { c = c.substring(1, c.length); }
						if (c.indexOf(nameEQ) === 0) { return c.substring(nameEQ.length, c.length); }
					}
					return null;
				}
				
				function clearCookie(name) {
					setCookie(name, "", -1);
				}
			});
		</script>
		<style>
			* {
				box-sizing: border-box;
				text-align: center;
				font-family: sans-serif;
				font-size: 36pt;
			}
			#selectButton {
				padding: 16px;
			}
			#sectionWrapper>* {
				margin-top: 64px;
				margin-bottom: 64px;
			}
			#timeLimitMessage {
				color: red;
				font-size: smaller;
			}
			#resultWrapper>* {
				margin-top: 16px;
				margin-bottom: 16px;
			}
			#resultName {
				font-weight: bold;
			}
			#resultAlcohol {
				margin-left: 16px;
				font-size: smaller;
				vertical-align: baseline;
			}
		</style>
	</head>
	<body>
		<div id="sectionWrapper">
			<div>
				<button id="selectButton">Random Alcohol</button>
			</div>
			<div id="resultWrapper" style="display: none;">
				<span id="resultName"></span>
				<span id="resultAlcohol"></span>
			</div>
			<div id="timeLimitMessage" style="display: none;">
				Go drink your shot.
			</div>
			<div id="error" style="display: none;"></div>
		</div>
	</body>
</html>
